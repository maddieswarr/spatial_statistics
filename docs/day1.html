<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>1&nbsp; The new spatial stack in R – Geospatial Data Science in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./day2.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./day1.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The new spatial stack in R</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Geospatial Data Science in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/edzer/madrid/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The new spatial stack in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Operations, raster-vector, vector-raster</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">inference: spatial correlation, fitting models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./day4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">prediction and simulation</span></span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#learning-goals" id="toc-learning-goals" class="nav-link active" data-scroll-target="#learning-goals">Learning goals</a></li>
  <li>
<a href="#what-is-special-about-spatial-data" id="toc-what-is-special-about-spatial-data" class="nav-link" data-scroll-target="#what-is-special-about-spatial-data"><span class="header-section-number">1.1</span> What is special about spatial data?</a>
  <ul class="collapse">
<li><a href="#support-examples" id="toc-support-examples" class="nav-link" data-scroll-target="#support-examples">Support: examples</a></li>
  </ul>
</li>
  <li><a href="#spatial-vs.-geospatial" id="toc-spatial-vs.-geospatial" class="nav-link" data-scroll-target="#spatial-vs.-geospatial"><span class="header-section-number">1.2</span> Spatial vs.&nbsp;Geospatial</a></li>
  <li>
<a href="#simple-features" id="toc-simple-features" class="nav-link" data-scroll-target="#simple-features"><span class="header-section-number">1.3</span> Simple features</a>
  <ul class="collapse">
<li><a href="#intro-to-sf-and-stars" id="toc-intro-to-sf-and-stars" class="nav-link" data-scroll-target="#intro-to-sf-and-stars">Intro to <code>sf</code> and <code>stars</code></a></li>
  <li><a href="#valid-polygons" id="toc-valid-polygons" class="nav-link" data-scroll-target="#valid-polygons">Valid polygons</a></li>
  <li><a href="#de-9im-dimensionally-extended-nine-intersection-model" id="toc-de-9im-dimensionally-extended-nine-intersection-model" class="nav-link" data-scroll-target="#de-9im-dimensionally-extended-nine-intersection-model">DE-9IM: dimensionally extended nine-intersection model</a></li>
  <li><a href="#de9-im-challenges" id="toc-de9-im-challenges" class="nav-link" data-scroll-target="#de9-im-challenges">DE9-IM: challenges</a></li>
  <li><a href="#vector-and-raster-data" id="toc-vector-and-raster-data" class="nav-link" data-scroll-target="#vector-and-raster-data">vector and raster data</a></li>
  <li><a href="#data-cubes" id="toc-data-cubes" class="nav-link" data-scroll-target="#data-cubes">data cubes</a></li>
  </ul>
</li>
  <li>
<a href="#the-spatial-statistics-data-types" id="toc-the-spatial-statistics-data-types" class="nav-link" data-scroll-target="#the-spatial-statistics-data-types"><span class="header-section-number">1.4</span> The spatial statistics data types</a>
  <ul class="collapse">
<li><a href="#point-patterns" id="toc-point-patterns" class="nav-link" data-scroll-target="#point-patterns">Point Patterns</a></li>
  <li><a href="#geostatistical-data-locations-measured-values" id="toc-geostatistical-data-locations-measured-values" class="nav-link" data-scroll-target="#geostatistical-data-locations-measured-values">Geostatistical data: locations + measured values</a></li>
  <li><a href="#areal-data" id="toc-areal-data" class="nav-link" data-scroll-target="#areal-data">Areal data</a></li>
  </ul>
</li>
  <li>
<a href="#data-types-that-received-less-attention-in-the-spatial-statistics-literature" id="toc-data-types-that-received-less-attention-in-the-spatial-statistics-literature" class="nav-link" data-scroll-target="#data-types-that-received-less-attention-in-the-spatial-statistics-literature"><span class="header-section-number">1.5</span> Data types that received less attention in the spatial statistics literature</a>
  <ul class="collapse">
<li><a href="#image-data" id="toc-image-data" class="nav-link" data-scroll-target="#image-data">Image data</a></li>
  <li><a href="#tracking-data-trajectories" id="toc-tracking-data-trajectories" class="nav-link" data-scroll-target="#tracking-data-trajectories">Tracking data, trajectories</a></li>
  <li><a href="#design-based-statistics" id="toc-design-based-statistics" class="nav-link" data-scroll-target="#design-based-statistics">Design-based statistics</a></li>
  <li><a href="#model-based-statistics" id="toc-model-based-statistics" class="nav-link" data-scroll-target="#model-based-statistics">Model-based statistics</a></li>
  <li><a href="#design--or-model-based" id="toc-design--or-model-based" class="nav-link" data-scroll-target="#design--or-model-based">Design- or model-based?</a></li>
  </ul>
</li>
  <li><a href="#checklist-if-you-have-spatial-data" id="toc-checklist-if-you-have-spatial-data" class="nav-link" data-scroll-target="#checklist-if-you-have-spatial-data"><span class="header-section-number">1.6</span> Checklist if you have spatial data</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">1.7</span> Exercises</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading"><span class="header-section-number">1.8</span> Further reading</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/edzer/madrid/edit/main/day1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">The new spatial stack in R</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="learning-goals" class="level3"><h3 class="anchored" data-anchor-id="learning-goals">Learning goals</h3>
<ul>
<li>learn the different data types considered in spatial statistics, and get familiar with simple features, as well as with the difference between discrete and continuous variability in <em>space</em> and in <em>attributes</em>
</li>
<li>learn what spatial dependence is about, and cases where it can be ignored</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="Summary">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Introduction to spatial data, support, coordinate reference systems</li>
<li>Introduction to spatial statistical data types: point patterns, geostatistical data, lattice data; imagery, tracks/trajectories</li>
<li>Is spatial dependence a fact? And is it a curse, or a blessing?</li>
<li>Spatial sampling, design-based and model-based inference</li>
<li>Checklist for your spatial data</li>
</ul>
</div>
</div>
</section><section id="what-is-special-about-spatial-data" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="what-is-special-about-spatial-data">
<span class="header-section-number">1.1</span> What is special about spatial data?</h2>
<ul>
<li>
<strong>Location</strong>. Does location always involve coordinates? Relative/absolute, qualitative/quantitative</li>
<li>
<strong>Coordinates</strong>. What are coordinates? Dimension(s), unit</li>
<li>
<strong>Time</strong>. If not explicit, there is an implicit time reference. Dimension(s), unit, datetime</li>
<li>
<strong>Attributes</strong>. <em>at</em> specific locations we measure (observe) specific properties</li>
<li>Quite often, we want to know <em>where</em> things change (<strong>space-time interactions</strong>).</li>
<li>
<strong>Reference systems</strong> for space, time, and attributes: what are they?</li>
<li>
<strong>Support</strong>: if we have an attribute value associated with a line, polygon or grid cell:
<ul>
<li>does the value <em>summarise</em> all values at points? (line/area/cell support), <strong>or</strong>
</li>
<li>is the value constant throughout the line/area/cell (point support)?</li>
</ul>
</li>
<li>
<strong>Continuity</strong>:
<ul>
<li>is a variable <em>spatially</em> continuous? Yes for <em>geostatistical data</em>, no for <em>point patterns</em>
</li>
<li>is an <em>attribute variable</em> continuous? <a href="https://www.science.org/doi/pdf/10.1126/science.103.2684.677?casa_token=H8am2h3sIYUAAAAA:eUd2ZU6ZRyJNqx4jdRv0E9WG7k3OBXAVbqgZ2O-Bl7pHNJSI0L2h9TM6i3YXve2nY5rD_4RbI2aecQ">Stevens’s measurement scales</a>: yes if <em>Interval</em> or <em>Ratio</em>.</li>
</ul>
</li>
</ul>
<section id="support-examples" class="level3"><h3 class="anchored" data-anchor-id="support-examples">Support: examples</h3>
<ul>
<li>Road properties
<ul>
<li>road type: gravel, brick, asphalt (point support: everywhere on the whole road)</li>
<li>mean width: block support (summary value)</li>
<li>minimum width: block support (although the minimum width may be the value at a single (point) location, it summarizes all widths of the road–we no longer know the width at any specific point location)</li>
</ul>
</li>
<li>Land use/land cover
<ul>
<li>when we classify e.g.&nbsp;30 m x 30 m Landsat pixels into a single class, this single class is not constant throughout this pixel</li>
<li>road type is a land cover type, but a road never covers a 30 m x 30 m pixel</li>
<li>a land cover type like “urban” is associated with a positive (non-point) support: we don’t say a point in a garden or park is urban, or a point on a roof, but these are part of a (block support) urban fabric</li>
</ul>
</li>
<li>Elevation
<ul>
<li>in principle, we can measure elevation at a point; in practice, every measuring device has a physical (non-point) size</li>
</ul>
</li>
<li>Further reading: <a href="https://r-spatial.org/book/05-Attributes.html">Chapter 5: Attributes and Support</a>
</li>
</ul></section></section><section id="spatial-vs.-geospatial" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="spatial-vs.-geospatial">
<span class="header-section-number">1.2</span> Spatial vs.&nbsp;Geospatial</h2>
<ul>
<li>Spatial refers (physical) spaces, 2- or 3-dimensional (<span class="math inline">\(R^2\)</span> or <span class="math inline">\(R^3\)</span>)
<ul>
<li>Most often spatial statistics considers 2-dimensional problems</li>
<li>3-d: meteorology, climate science, geophysics, groundwater hydrology, aeronautics, …</li>
<li>with <em>time</em>: spatiotemporal, this becomes 3- or 4-dimensional (<span class="math inline">\(R^3\)</span> or <span class="math inline">\(R^4\)</span>)</li>
</ul>
</li>
<li>“Geo” refers to the Earth</li>
<li>For Earth coordinates, we always need a <em>datum</em>, consisting of an ellipsoid (shape) and the way it is fixed to the Earth (origin)
<ul>
<li>The Earth is modelled by an ellipsoid, which is nearly round</li>
<li>If we consider Earth-bound areas as flat, for larger areas we get the distances wrong</li>
<li>We can (and do) also work on <span class="math inline">\(S^2\)</span>, the surface of a sphere, rather than <span class="math inline">\(R^2\)</span>, to get distances right, but this creates a number of challenges (such as plotting on a 2D device)</li>
</ul>
</li>
<li>Non-geospatial spaces could be:
<ul>
<li>Associated with other bodies (moon, Mars: similar “size”)</li>
<li>Astrophysics, places/directions in the universe (different size/scale)</li>
<li>Locations in a building (where we use “engineering coordinates”, relative to a building corner and orientation) (different size/scale)</li>
<li>Microscope images (different size/scale)</li>
<li>MRT scans (3-D), places in a human body (different size/scale)</li>
<li>locations on a genome? (different size/scale)</li>
</ul>
</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="co"># Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="fl">.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>axes<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="day1_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>world map, with longitude and latitude map linearly to x and y (<a href="https://en.wikipedia.org/wiki/Equirectangular_projection">Plate Caree</a>): does the Earth look like this?</figcaption></figure>
</div>
</div>
</div>
</section><section id="simple-features" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="simple-features">
<span class="header-section-number">1.3</span> Simple features</h2>
<p>“Simple features” comes from <em>simple feature access</em>, an OGC <a href="https://www.ogc.org/publications/standard/sfa/">standard</a>. OGC stands for “Open Geospatial Consortium” and is a standardisation body; many OGC standards become ISO standards (for whatever it is worth!).</p>
<p>A feature is a “thing” that has</p>
<ul>
<li>a feature geometry (location, shape if not point)</li>
<li>other properties, called feature attributes</li>
</ul>
<p>“Simple” in “simple feature” refers to the property that geometries are points, lines or polygons, and that lines and polygon boundaries consists of sequences of points connected with <em>straight lines</em> (edges), and that edges do not cross other edges (do not self-intersect). Polygons consist of an outer (closed) ring with zero or more inner (closed) rings denoting holes.</p>
<p>Simple feature geometries are zero-dimensional (points), one-dimensional (linestrings), or two-dimensional (polygons). Each geometry has an interior (I), a boundary (B) and an exterior (E). For polygons this is trivial, but</p>
<ul>
<li>points: have an interior but no boundary</li>
<li>lines: have a boundary that consists of the end points, all other points are interior</li>
</ul>
<section id="intro-to-sf-and-stars" class="level3"><h3 class="anchored" data-anchor-id="intro-to-sf-and-stars">Intro to <code>sf</code> and <code>stars</code>
</h3>
<ul>
<li>Briefly: <code>sf</code> provides classes and methods for <em>simple features</em>
<ul>
<li>a feature is a “thing”, with geometrical properties (point(s), line(s), polygon(s)) and attributes</li>
<li>
<code>sf</code> stores data in <code>data.frame</code>s with a list-column (of class <code>sfc</code>) that holds the geometries</li>
</ul>
</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled" title="the Simple Feature standard">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
the Simple Feature standard
</div>
</div>
<div class="callout-body-container callout-body">
<p>“Simple Feature Access” is an <a href="https://www.ogc.org/standard/sfa/">open standard</a> for data with vector geometries. It defines a set of classes for geometries and operations on them.</p>
<ul>
<li>“simple” refers to curves that are “simply” represented by points connected by straight lines</li>
<li>connecting lines are not allowed to <a href="https://r-spatial.org/book/03-Geometries.html#sec-valid">self-intersect</a>
</li>
<li>polygons can have holes, and have validity constraints: holes cannot extrude the outer ring etc.</li>
<li>All spatial software uses this: ArcGIS, QGIS, PostGIS, other spatial databases, …</li>
</ul>
</div>
</div>
<section id="why-do-all-functions-in-sf-start-with-st_" class="level4"><h4 class="anchored" data-anchor-id="why-do-all-functions-in-sf-start-with-st_">Why do all functions in <code>sf</code> start with <code>st_</code>?</h4>
<ul>
<li>see <a href="https://ecoevo.social/@noamross/112055449473807578">here</a>
</li>
</ul></section><section id="sf-operators-how-to-understand" class="level4"><h4 class="anchored" data-anchor-id="sf-operators-how-to-understand">
<code>sf</code> operators, how to understand?</h4>
<p>Package <code>sf</code> has objects at three nested “levels”:</p>
<ul>
<li><p><code>sfg</code>: a single geometry (without coordinate reference system); contained in:</p></li>
<li><p><code>sfc</code>: a set of <code>sfg</code> geometries (<code>list</code>), with a coordinate reference system and bounding box; contained in:</p></li>
<li><p><code>sf</code>: a <code>data.frame</code> or <code>tibble</code> with at least one geometry (<code>sfc</code>) column</p></li>
<li>
<p>Operations <em>not</em> involving geometry (<code>data.frame</code>; base R; tidyverse)</p>
<ul>
<li>geometry column + <code>sf</code> class is sticky!</li>
<li>this can be convenient, and sometimes annoying</li>
<li>use <code>as.data.frame</code> or <code>as_tibble</code> to strip the <code>sf</code> class label</li>
</ul>
</li>
<li>
<p>Operations involving <em>only</em> geometry</p>
<ul>
<li>
<strong>predicates</strong> (resulting <code>TRUE</code>/<code>FALSE</code>)
<ul>
<li>unary</li>
<li>binary: <a href="https://en.wikipedia.org/wiki/DE-9IM">DE9-IM</a>; work on two sets, result <code>sgbp</code>, which is a sparse logical matrix representation
<ul>
<li>is_within_distance</li>
</ul>
</li>
</ul>
</li>
<li>
<strong>measures</strong>
<ul>
<li>unary: length, area</li>
<li>binary: distance, <code>by_element = FALSE</code>
</li>
</ul>
</li>
<li>
<strong>transformers</strong>
<ul>
<li>unary: buffer, centroid</li>
<li>binary: intersection, union, difference, symdifference</li>
<li>n-ary: intersection, difference</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Operations involving geometry <em>and</em> attributes</p>
<ul>
<li>many of the above!</li>
<li><code>st_join</code></li>
<li><code>aggregate</code></li>
<li>
<code>st_interpolate_aw</code>: requires expression whether variable is spatially <em>extensive</em> or <em>intensive</em>
</li>
</ul>
</li>
</ul></section><section id="sf-and-spatstat" class="level4"><h4 class="anchored" data-anchor-id="sf-and-spatstat">
<code>sf</code> and <code>spatstat</code>
</h4>
<p>We can try to convert an <code>sf</code> object to a <code>ppp</code> (point pattern object in <code>spatstat</code>):</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/">spatstat</a></span><span class="op">)</span></span>
<span><span class="co"># Loading required package: spatstat.data</span></span>
<span><span class="co"># Loading required package: spatstat.univar</span></span>
<span><span class="co"># spatstat.univar 3.1-1</span></span>
<span><span class="co"># Loading required package: spatstat.geom</span></span>
<span><span class="co"># spatstat.geom 3.3-4</span></span>
<span><span class="co"># Loading required package: spatstat.random</span></span>
<span><span class="co"># spatstat.random 3.3-2</span></span>
<span><span class="co"># Loading required package: spatstat.explore</span></span>
<span><span class="co"># Loading required package: nlme</span></span>
<span><span class="co"># spatstat.explore 3.3-4</span></span>
<span><span class="co"># Loading required package: spatstat.model</span></span>
<span><span class="co"># Loading required package: rpart</span></span>
<span><span class="co"># spatstat.model 3.3-3</span></span>
<span><span class="co"># Loading required package: spatstat.linnet</span></span>
<span><span class="co"># spatstat.linnet 3.2-3</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># spatstat 3.3-0 </span></span>
<span><span class="co"># For an introduction to spatstat, type 'beginner'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/demo.html">demo</a></span><span class="op">(</span><span class="va">nc</span>, echo <span class="op">=</span> <span class="cn">FALSE</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">pts</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html">st_geometry</a></span><span class="op">(</span><span class="va">nc</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/as.ppp.html">as.ppp</a></span><span class="op">(</span><span class="va">pts</span><span class="op">)</span> <span class="co"># ???</span></span>
<span><span class="co"># Error: Only projected coordinates may be converted to spatstat</span></span>
<span><span class="co"># class objects</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that <code>sf</code> interprets a <code>NA</code> CRS as: flat, projected (Cartesian) space.</p>
</section><section id="stars" class="level4"><h4 class="anchored" data-anchor-id="stars"><code>stars</code></h4>
<p>Packages <code>stars</code> is a package for (dense) array data, where array dimensions are associated with space and/or time (spatial time series, data cubes). It is built for simplicity (pure R), and for maximum integration with <code>sf</code>.</p>
<p>R’s <code>array</code> is very powerful, but its metadata (<code>dimnames</code>) is restricted to <code>character</code> vectors.</p>
<p>A <code>stars</code> object</p>
<ul>
<li>is a list with R arrays (or pointers to files with such arrays)</li>
<li>has a <code>dimensions</code> attribute with all the metadata of the dimensions (offset, cellsize, units, reference system, point/block support)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span></span>
<span><span class="co"># Loading required package: abind</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html">st_as_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># default: 1 degree global Cartesian grid</span></span>
<span><span class="co"># stars object with 2 dimensions and 1 attribute</span></span>
<span><span class="co"># attribute(s):</span></span>
<span><span class="co">#         Min. 1st Qu. Median Mean 3rd Qu. Max.</span></span>
<span><span class="co"># values     0       0      0    0       0    0</span></span>
<span><span class="co"># dimension(s):</span></span>
<span><span class="co">#   from  to offset delta         refsys x/y</span></span>
<span><span class="co"># x    1 360   -180     1 WGS 84 (CRS84) [x]</span></span>
<span><span class="co"># y    1 180     90    -1 WGS 84 (CRS84) [y]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="valid-polygons" class="level3"><h3 class="anchored" data-anchor-id="valid-polygons">Valid polygons</h3>
<p>Valid polygons are polygons with several geometrical constraints, such as</p>
<ul>
<li>a closed ring means the first and last coordinate are identical,</li>
<li>no edge is traversed twice,</li>
<li>a hole can touch an outer ring only in a point, not along a line(string)</li>
<li>holes are inside the outer ring</li>
<li>outer rings are winded counter-clockwise (CCW), inner rings (holes) clockwise (CW)</li>
</ul>
<p>In particular the last condition is often dropped, as the order of the rings already denotes their role, and winding can easily reversed. An exception of this is polygons on the sphere, where <em>both</em> inside and outside have a limited area.</p>
</section><section id="de-9im-dimensionally-extended-nine-intersection-model" class="level3"><h3 class="anchored" data-anchor-id="de-9im-dimensionally-extended-nine-intersection-model">DE-9IM: dimensionally extended nine-intersection model</h3>
<p>The <em>intersection</em> of two geometries is the set of points they have in common. This set can be empty (no points), 0-, 1-, or 2-dimensional. The DE-9IM defines the <strong>relation</strong> between two geometries as the intersection of I, B and E of the first and the second geometry (hence: 9, see https://r-spatial.org/book/03-Geometries.html#fig-de9im). The values can be <code>F</code> (empty), <code>0</code>, <code>1</code> or <code>2</code> (dimension if not empty), or <code>T</code> (not empty: any of 0, 1 or 2). Using the resulting encoding (the relation), one can define special predicates, such as</p>
<ul>
<li>A <em>covers</em> B</li>
<li>A <em>contains</em> B</li>
<li>A is <em>disjoint</em> from B</li>
<li>A <em>equals</em> B</li>
</ul>
<p>and many more on; one can also define custom queries with a specific pattern, e.g.:</p>
<ul>
<li>A <em>relates</em> to B according to pattern <code>0FFFFFFF2</code>.</li>
</ul></section><section id="de9-im-challenges" class="level3"><h3 class="anchored" data-anchor-id="de9-im-challenges">DE9-IM: challenges</h3>
<p>We often work with polygon data that form a <em>polygon coverage</em>, which is a tesselation of an area of interest, e.g.</p>
<ul>
<li>countries in a continent,</li>
<li>provinces in a country,</li>
<li>counties in a province</li>
</ul>
<p>When representing the polygons as a set of outer rings, it is hard to see whether there are no overlaps, and no gaps between polygons. Such overlaps or gaps could result from generalisation of polygon boundaries, one-by-one, and not by first identifying a common boundary and then generalizing that.</p>
<p>“True” geographic information systems (e.g.&nbsp;ArcGIS or GRASS GIS) use a topological representation of geometries that consists of edge nodes and (outer and inner) <em>boundaries</em>, and can do such simplifications without creating overlaps or gaps.</p>
<p>Another challenge is that polygon coverages represented as a set of simple feature polygons do not uniquely assign all points to a single unit. Points on a boundary common to two geometries intersect with both, there is no geometric argument to assign them unambiguously to only one of them.</p>
<p>Finally, as the Earth is round, the use of <em>straight lines</em> is problematic:</p>
<ul>
<li>projection or re-projection changes space non-linearly, causing a straight line to change path</li>
<li>unprojected data are associated with a sphere (or ellipsoid), leading to <strong>options</strong> what “straight” means, e.g.
<ul>
<li>GeoJSON <a href="https://datatracker.ietf.org/doc/html/rfc7946#section-3.1.1">defines straight lines</a> as straight in Plate Carree</li>
<li>s2geometry assumes <a href="https://en.wikipedia.org/wiki/Great-circle_distance">great circle</a> segments</li>
</ul>
</li>
</ul></section><section id="vector-and-raster-data" class="level3"><h3 class="anchored" data-anchor-id="vector-and-raster-data">vector and raster data</h3>
<p>In addition to vector (point/line/polygon) data, we also have <em>raster data</em>. For <em>regular</em> rasters, space is cut into square cells, aligned with <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>. Raster spaces <em>can</em> tesselate, see <a href="https://r-spatial.org/book/03-Geometries.html#raster-tessellations">here</a>.</p>
<p>In addition to regular rasters, we have rotated, sheared, rectilinear and curvilinear rasters. The raster <em>space</em> is primarily flat, so any time we use it model data of the Earth surface, we violate the constant raster cell size concept. Many data are distributed as regular rasters in geodetic coordinates (long/lat space, e.g., 0.25 degree raster cells), mostly for convienience (of who?)</p>
<p><strong>Discrete global grids</strong> are (semi-)regular tesselations of the Earth surface, using squares, triangles, or hexagons. Examples are:</p>
<ul>
<li>Google’s <a href="http://s2geometry.io/">s2geometry</a> (R package <a href="https://cran.r-project.org/web/packages/s2/index.html">s2</a>)</li>
<li>Uber’s <a href="https://www.uber.com/en-FR/blog/h3/">H3</a> (R package <a href="https://cran.r-project.org/web/packages/h3r/index.html">h3r</a>)</li>
<li>Kevin Sahr’s <a href="https://discreteglobal.wpengine.com/">dggrid</a> (also nested hexagons; R package <a href="https://cran.r-project.org/web/packages/dggridR/index.html">dggridr</a>)</li>
</ul>
<p>Interestingly, computer screens are raster devices, so any time we do view vector data on a computer screen, a rasterization has taken place.</p>
</section><section id="data-cubes" class="level3"><h3 class="anchored" data-anchor-id="data-cubes">data cubes</h3>
<p>Data cubes are <em>array data</em> with one or more dimensions associated with space or geometry. The degenerate example is a one-dimensional array (or collection thereof), which we have in a table or data.frame. The canonical example of array data is raster data, or a time series thereof.</p>
<p>Further examples include:</p>
<ul>
<li>3D rasters, including depth/height (atmospheric, geological)</li>
<li>time series for points (one dimension with feature geometries)</li>
<li>time series for areas (one dimension with feature geometries)</li>
<li>Origin-destination (OD) matrices (two dimensions with feature geometries)</li>
<li>OD matrices as a function of time</li>
</ul></section></section><section id="the-spatial-statistics-data-types" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="the-spatial-statistics-data-types">
<span class="header-section-number">1.4</span> The spatial statistics data types</h2>
<section id="point-patterns" class="level3"><h3 class="anchored" data-anchor-id="point-patterns">Point Patterns</h3>
<ul>
<li>Points (locations) + observation window</li>
<li>Example from <a href="https://opendata-esri-de.opendata.arcgis.com/datasets/dc6d012f47d94fde99deacc316721f30/explore?location=51.099061%2C10.453852%2C7.45">here</a>
</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gdal-fig-nodetails" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gdal-fig-nodetails-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="turbines.png" class="img-fluid figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gdal-fig-nodetails-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.1: Wind turbine parks in Germany
</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>The locations contain the information</li>
<li>Points may have (discrete or continuous) <em>marks</em> (attributes)</li>
<li>The <em>observation window</em> tells where there are no points (empty space)</li>
</ul></section><section id="geostatistical-data-locations-measured-values" class="level3"><h3 class="anchored" data-anchor-id="geostatistical-data-locations-measured-values">Geostatistical data: locations + measured values</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span>
<span><span class="va">no2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"external/no2.csv"</span>,</span>
<span>    package <span class="op">=</span> <span class="st">"gstat"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">crs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:32632"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">no2</span>, crs <span class="op">=</span> <span class="st">"OGC:CRS84"</span>, coords <span class="op">=</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"station_longitude_deg"</span>, <span class="st">"station_latitude_deg"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">crs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">no2.sf</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># plot(st_geometry(no2.sf))</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">read_sf</a></span><span class="op">(</span><span class="st">"de_nuts1.gpkg"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform</a></span><span class="op">(</span><span class="va">crs</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">de</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">de</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">no2.sf</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">NO2</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="day1_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>NO2 measurements at rural background stations (EEA)</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>The value of interest is measured at a set of sample locations</li>
<li>At other location, this value exists but is <em>missing</em>
</li>
<li>The interest is in estimating (predicting) this missing value (interpolation)</li>
<li>The actual sample locations are not of (primary) interest, the signal is in the measured values</li>
</ul></section><section id="areal-data" class="level3"><h3 class="anchored" data-anchor-id="areal-data">Areal data</h3>
<ul>
<li>polygons (or grid cells) + polygon summary values</li>
</ul>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># https://en.wikipedia.org/wiki/List_of_NUTS_regions_in_the_European_Union_by_GDP</span></span>
<span><span class="va">de</span><span class="op">$</span><span class="va">GDP_percap</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">45200</span>, <span class="fl">46100</span>, <span class="fl">37900</span>, <span class="fl">27800</span>, <span class="fl">49700</span>, <span class="fl">64700</span>, <span class="fl">45000</span>, <span class="fl">26700</span>, <span class="fl">36500</span>, <span class="fl">38700</span>, <span class="fl">35700</span>, <span class="fl">35300</span>, <span class="fl">29900</span>, <span class="fl">27400</span>, <span class="fl">32400</span>, <span class="fl">28900</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">de</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">de</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">GDP_percap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="va">de</span>, <span class="st">"MULTILINESTRING"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="day1_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>NO2 rural background, average values per NUTS1 region</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>The polygons contain polygon summary (polygon support) values, not values that are constant throughout the polygon (as in a soil, lithology or land cover map)</li>
<li>Neighbouring polygons are typically related: spatial correlation</li>
<li>neighbour-neighbour correlation: Moran’s I</li>
<li>regression models with correlated errors, spatial lag models, CAR models, GMRFs, …</li>
<li>see Ch 14-17 of <a href="https://r-spatial.org/book/">SDSWR</a>
</li>
<li>briefly addressed on Friday</li>
</ul></section></section><section id="data-types-that-received-less-attention-in-the-spatial-statistics-literature" class="level2" data-number="1.5"><h2 data-number="1.5" class="anchored" data-anchor-id="data-types-that-received-less-attention-in-the-spatial-statistics-literature">
<span class="header-section-number">1.5</span> Data types that received less attention in the spatial statistics literature</h2>
<section id="image-data" class="level3"><h3 class="anchored" data-anchor-id="image-data">Image data</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">L7_ETMs</span>, rgb <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="day1_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>RGB image from a Landsat scene</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>are these geostatistical data, or areal data?</li>
<li>If we identify objects from images, can we see them as point patterns?</li>
</ul></section><section id="tracking-data-trajectories" class="level3"><h3 class="anchored" data-anchor-id="tracking-data-trajectories">Tracking data, trajectories</h3>
<div class="cell">
<details class="code-fold"><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># from: https://r-spatial.org/r/2017/08/28/nest.html</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co"># ── Attaching core tidyverse packages ──────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co"># ✔ dplyr     1.1.4     ✔ readr     2.1.5</span></span>
<span><span class="co"># ✔ forcats   1.0.0     ✔ stringr   1.5.1</span></span>
<span><span class="co"># ✔ lubridate 1.9.4     ✔ tibble    3.2.1</span></span>
<span><span class="co"># ✔ purrr     1.0.2     ✔ tidyr     1.3.1</span></span>
<span><span class="co"># ── Conflicts ────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co"># ✖ dplyr::collapse() masks nlme::collapse()</span></span>
<span><span class="co"># ✖ dplyr::filter()   masks stats::filter()</span></span>
<span><span class="co"># ✖ dplyr::lag()      masks stats::lag()</span></span>
<span><span class="co"># ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</span></span>
<span><span class="va">storms.sf</span> <span class="op">&lt;-</span> <span class="va">storms</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"long"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">storms.sf</span> <span class="op">&lt;-</span> <span class="va">storms.sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">year</span>,<span class="va">month</span>,<span class="va">day</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>, </span>
<span>                                   <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">hour</span>, <span class="st">":00"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">month</span>, <span class="op">-</span><span class="va">day</span>, <span class="op">-</span><span class="va">hour</span><span class="op">)</span></span>
<span><span class="va">storms.nest</span> <span class="op">&lt;-</span> <span class="va">storms.sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">nest</span></span>
<span><span class="va">to_line</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">tr</span><span class="op">)</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html">st_cast</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_combine.html">st_combine</a></span><span class="op">(</span><span class="va">tr</span><span class="op">)</span>, <span class="st">"LINESTRING"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="va">.</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> </span>
<span><span class="va">tracks</span> <span class="op">&lt;-</span> <span class="va">storms.nest</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span><span class="op">(</span><span class="va">to_line</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html">st_sfc</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="va">storms.tr</span> <span class="op">&lt;-</span> <span class="va">storms.nest</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html">st_sf</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">tracks</span><span class="op">)</span></span>
<span><span class="va">storms.tr</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html">geom_sf</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="day1_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Storm/hurricane trajectories colored by year</figcaption></figure>
</div>
</div>
</div>
<ul>
<li>A temporal snapshot (time slice) of a set of moving things forms a point pattern</li>
<li>We often analyse trajectories by
<ul>
<li>estimating densities, for space-time blocks, per individual or together</li>
<li>analysing interactions (alibi problem, mating animals, home range, UDF etc)</li>
</ul>
</li>
</ul></section><section id="design-based-statistics" class="level3"><h3 class="anchored" data-anchor-id="design-based-statistics">Design-based statistics</h3>
<p>In design-based statistics, randomness comes from random sampling. Consider an area <span class="math inline">\(B\)</span>, from which we take samples <span class="math display">\[z(s),
s \in B,\]</span> with <span class="math inline">\(s\)</span> a location for instance two-dimensional: <span class="math inline">\(s_i =
\{x_i,y_i\}\)</span>. If we select the samples <em>randomly</em>, we can consider <span class="math inline">\(S \in B\)</span> a random variable, and <span class="math inline">\(z(S)\)</span> a random sample. Note the randomness in <span class="math inline">\(S\)</span>, not in <span class="math inline">\(z\)</span>.</p>
<p>Two variables <span class="math inline">\(z(S_1)\)</span> and <span class="math inline">\(z(S_2)\)</span> are <em>independent</em> if <span class="math inline">\(S_1\)</span> and <span class="math inline">\(S_2\)</span> are sampled independently. For estimation we need to know the inclusion probabilities, which need to be non-negative for every location.</p>
<p>If inclusion probabilities are constant (simple random sampling; or complete spatial randomness: day 2, point patterns) then we can estimate the mean of <span class="math inline">\(Z(B)\)</span> by the sample mean <span class="math display">\[\frac{1}{n}\sum_{j=1}^n
z(s_j).\]</span> This also predicts the value of a <em>randomly</em> chosen observation <span class="math inline">\(z(S)\)</span>. It cannot be used to predict the value <span class="math inline">\(z(s_0)\)</span> for a non-randomly chosen location <span class="math inline">\(s_0\)</span>; for this we need a model.</p>
</section><section id="model-based-statistics" class="level3"><h3 class="anchored" data-anchor-id="model-based-statistics">Model-based statistics</h3>
<p>Model-based statistics assumes randomness in the measured responses; consider a regression model <span class="math inline">\(y = X\beta + e\)</span>, where <span class="math inline">\(e\)</span> is a random variable and as a consequence <span class="math inline">\(y\)</span>, the response variable is a random variable. In the spatial context we replace <span class="math inline">\(y\)</span> with <span class="math inline">\(z\)</span>, and capitalize it to indicate it is a random variable, and write <span class="math display">\[Z(s) = X(s)\beta + e(s)\]</span> to stress that</p>
<ul>
<li>
<span class="math inline">\(Z(s)\)</span> is a random function (random variables <span class="math inline">\(Z\)</span> as a function of <span class="math inline">\(s\)</span>)</li>
<li>
<span class="math inline">\(X(s)\)</span> is the matrix with covariates, which depend on <span class="math inline">\(s\)</span>
</li>
<li>
<span class="math inline">\(\beta\)</span> are (spatially) constant coefficients, not depening on <span class="math inline">\(s\)</span>
</li>
<li>
<span class="math inline">\(e(s)\)</span> is a random function with mean zero and covariance matrix <span class="math inline">\(\Sigma\)</span>
</li>
</ul>
<p>In the regression literature this is called a (linear) mixed model, because <span class="math inline">\(e\)</span> is not i.i.d. If <span class="math inline">\(e(s)\)</span> contains an iid component <span class="math inline">\(\epsilon\)</span> we can write this as</p>
<p><span class="math display">\[Z(s) = X(s)\beta + w(s) + \epsilon\]</span></p>
<p>with <span class="math inline">\(w(s)\)</span> the spatial signal, and <span class="math inline">\(\epsilon\)</span> a noise compenent e.g.&nbsp;due to measurement error.</p>
<p>Predicting <span class="math inline">\(Z(s_0)\)</span> will involve (GLS) estimation of <span class="math inline">\(\beta\)</span>, but also prediction of <span class="math inline">\(e(s_0)\)</span> using correlated, nearby observations (day 3: geostatistics).</p>
</section><section id="design--or-model-based" class="level3"><h3 class="anchored" data-anchor-id="design--or-model-based">Design- or model-based?</h3>
<ul>
<li>design-based requires a random sample, if that is the case it needs no further assumptions</li>
<li>model-based requires stationarity assumptions to estimate <span class="math inline">\(\Sigma\)</span>
</li>
<li>model-based is typically more effective for interpolation problems</li>
<li>design-based can be most effective when estimating, e.g.&nbsp;average mapping errors</li>
</ul></section></section><section id="checklist-if-you-have-spatial-data" class="level2" data-number="1.6"><h2 data-number="1.6" class="anchored" data-anchor-id="checklist-if-you-have-spatial-data">
<span class="header-section-number">1.6</span> Checklist if you have spatial data</h2>
<ul>
<li>Do you have the spatial coordinates of your data?</li>
<li>Are the coordinates Earth-bound?</li>
<li>If yes, do you have the coordinate reference system of them?</li>
<li>What is the support (physical size) of your observations?</li>
<li>Were the data obtained by random sampling, and if yes, do you have sampling weights?</li>
<li>Do you know the <em>extent</em> from which your data were sampled, or collected?</li>
</ul></section><section id="exercises" class="level2" data-number="1.7"><h2 data-number="1.7" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">1.7</span> Exercises</h2>
<ul>
<li>What is the coordinate reference system of the <code><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html">ne_countries()</a></code> dataset, imported above?</li>
<li>Look up the “Equidistant Cylindrical (Plate Carrée)” projection on the <a href="https://proj.org" class="uri">https://proj.org</a> website.</li>
<li>Why is this projection called <em>The simplest of all projections</em>?</li>
<li>Project <code>ne_countries</code> to Plate Carrée, and plot it with <code>axes=TRUE</code>. What has changed? (Hint: <code><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs()</a></code> accepts a <em>proj string</em> to define a coordinate reference system (CRS); <code><a href="https://r-spatial.github.io/sf/reference/st_transform.html">st_transform()</a></code> transforms a dataset to a new CRS.)</li>
<li>Project the same dataset to Eckert IV projection. What has changed?</li>
<li>Also try plotting this dataset after transforming it to an orthographic projection with <code>+proj=ortho</code>; what went wrong?</li>
</ul>
<p>Next: continue with the <a href="https://r-spatial.org/book/03-Geometries.html#exercises">exercises of Chapter 3</a> of “Spatial Data Science: with applications in R”, then <a href="https://r-spatial.org/book/06-Cubes.html#exercises">those of Chapter 6</a>.</p>
</section><section id="further-reading" class="level2" data-number="1.8"><h2 data-number="1.8" class="anchored" data-anchor-id="further-reading">
<span class="header-section-number">1.8</span> Further reading</h2>
<ul>
<li>Ripley, B. 1981. Spatial Statistics. Wiley.</li>
<li>Cressie, N. 1993. Statistics for Spatial Data. Wiley.</li>
<li>Cochran, W.G. 1977. Sampling Techniques. Wiley.</li>
</ul>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/edzer\.github\.io\/madrid\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./day2.html" class="pagination-link" aria-label="Operations, raster-vector, vector-raster">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Operations, raster-vector, vector-raster</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb8" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># The new spatial stack in R</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">### Learning goals</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>learn the different data types considered in spatial statistics, and get familiar with simple features, as well as with the difference between discrete and continuous variability in *space* and in *attributes*</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>learn what spatial dependence is about, and cases where it can be ignored</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Summary"}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Introduction to spatial data, support, coordinate reference systems</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Introduction to spatial statistical data types: point patterns, geostatistical data, lattice data; imagery, tracks/trajectories</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Is spatial dependence a fact? And is it a curse, or a blessing?</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial sampling, design-based and model-based inference</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Checklist for your spatial data</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is special about spatial data?</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Location**. Does location always involve coordinates? Relative/absolute, qualitative/quantitative</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Coordinates**. What are coordinates? Dimension(s), unit</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Time**. If not explicit, there is an implicit time reference. Dimension(s), unit, datetime</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Attributes**. *at* specific locations we measure (observe) specific properties</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Quite often, we want to know *where* things change (**space-time interactions**).</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Reference systems** for space, time, and attributes: what are they?</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Support**: if we have an attribute value associated with a line, polygon or grid cell:</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>does the value _summarise_ all values at points? (line/area/cell support), **or**</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>is the value constant throughout the line/area/cell (point support)?</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Continuity**:</span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>is a variable *spatially* continuous? Yes for _geostatistical data_, no for _point patterns_</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>is an *attribute variable* continuous? [Stevens's measurement scales](https://www.science.org/doi/pdf/10.1126/science.103.2684.677?casa_token=H8am2h3sIYUAAAAA:eUd2ZU6ZRyJNqx4jdRv0E9WG7k3OBXAVbqgZ2O-Bl7pHNJSI0L2h9TM6i3YXve2nY5rD_4RbI2aecQ): yes if *Interval* or *Ratio*.</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="fu">### Support: examples</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Road properties</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>road type: gravel, brick, asphalt (point support: everywhere on the whole road)</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>mean width: block support (summary value)</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>minimum width: block support (although the minimum width may be the value at a single (point) location, it summarizes all widths of the road--we no longer know the width at any specific point location)</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Land use/land cover</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>when we classify e.g. 30 m x 30 m Landsat pixels into a single class, this single class is not constant throughout this pixel</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>road type is a land cover type, but a road never covers a 30 m x 30 m pixel</span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>a land cover type like "urban" is associated with a positive (non-point) support: we don't say a point in a garden or park is urban, or a point on a roof, but these are part of a (block support) urban fabric</span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Elevation</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>in principle, we can measure elevation at a point; in practice, every measuring device has a physical (non-point) size</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Further reading: <span class="co">[</span><span class="ot">Chapter 5: Attributes and Support</span><span class="co">](https://r-spatial.org/book/05-Attributes.html)</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="fu">## Spatial vs. Geospatial</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial refers (physical) spaces, 2- or 3-dimensional ($R^2$ or $R^3$)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Most often spatial statistics considers 2-dimensional problems</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>3-d: meteorology, climate science, geophysics, groundwater hydrology, aeronautics, ...</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>with _time_: spatiotemporal, this becomes 3- or 4-dimensional ($R^3$ or $R^4$)</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"Geo" refers to the Earth</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>For Earth coordinates, we always need a *datum*, consisting of an ellipsoid (shape) and the way it is fixed to the Earth (origin)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>The Earth is modelled by an ellipsoid, which is nearly round</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>If we consider Earth-bound areas as flat, for larger areas we get the distances wrong</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>We can (and do) also work on $S^2$, the surface of a sphere, rather than $R^2$, to get distances right, but this creates a number of challenges (such as plotting on a 2D device)</span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Non-geospatial spaces could be:</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Associated with other bodies (moon, Mars: similar "size")</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Astrophysics, places/directions in the universe (different size/scale)</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Locations in a building (where we use "engineering coordinates", relative to a building corner and orientation) (different size/scale)</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Microscope images (different size/scale)</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>MRT scans (3-D), places in a human body (different size/scale)</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>locations on a genome? (different size/scale)</span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: '100%'</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "world map, with longitude and latitude map linearly to x and y ([Plate Caree](https://en.wikipedia.org/wiki/Equirectangular_projection)): does the Earth look like this?"</span></span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">0</span>) <span class="sc">+</span> .<span class="dv">1</span>)</span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="fu">ne_countries</span>() <span class="sc">|&gt;</span> <span class="fu">st_geometry</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>(<span class="at">axes=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simple features </span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>"Simple features" comes from _simple feature access_, an OGC <span class="co">[</span><span class="ot">standard</span><span class="co">](https://www.ogc.org/publications/standard/sfa/)</span>.</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>OGC stands for "Open Geospatial Consortium" and is a standardisation body; many OGC standards become ISO standards (for whatever it is worth!).</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>A feature is a "thing" that has </span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a feature geometry (location, shape if not point)</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>other properties, called feature attributes</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>"Simple" in "simple feature" refers to the property that geometries are points, lines or polygons, and that lines and polygon boundaries consists of sequences of points connected with _straight lines_ (edges), and that edges do not cross other edges (do not self-intersect). Polygons consist of an outer (closed) ring with zero or more inner (closed) rings denoting holes.</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>Simple feature geometries are zero-dimensional (points), one-dimensional (linestrings), or two-dimensional (polygons). Each geometry has an interior (I), a boundary (B) and an exterior (E). For polygons this is trivial, but </span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>points: have an interior but no boundary</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>lines: have a boundary that consists of the end points, all other points are interior</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intro to `sf` and `stars`</span></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Briefly: <span class="in">`sf`</span> provides classes and methods for *simple features*</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>a feature is a "thing", with geometrical properties (point(s), line(s), polygon(s)) and attributes</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`sf`</span> stores data in <span class="in">`data.frame`</span>s with a list-column (of class <span class="in">`sfc`</span>) that holds the geometries</span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="the Simple Feature standard"}</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>"Simple Feature Access" is an <span class="co">[</span><span class="ot">open standard</span><span class="co">](https://www.ogc.org/standard/sfa/)</span> for data with vector geometries. It defines a set of classes for geometries and operations on them.</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>"simple" refers to curves that are "simply" represented by points connected by straight lines</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>connecting lines are not allowed to <span class="co">[</span><span class="ot">self-intersect</span><span class="co">](https://r-spatial.org/book/03-Geometries.html#sec-valid)</span></span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>polygons can have holes, and have validity constraints: holes cannot extrude the outer ring etc.</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>All spatial software uses this: ArcGIS, QGIS, PostGIS, other spatial databases, ...</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Why do all functions in `sf` start with `st_`?</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>see <span class="co">[</span><span class="ot">here</span><span class="co">](https://ecoevo.social/@noamross/112055449473807578)</span></span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `sf` operators, how to understand?</span></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>Package <span class="in">`sf`</span> has objects at three nested "levels":</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`sfg`</span>: a single geometry (without coordinate reference system); contained in:</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`sfc`</span>: a set of <span class="in">`sfg`</span> geometries (<span class="in">`list`</span>), with a coordinate reference system and bounding box; contained in:</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`sf`</span>: a <span class="in">`data.frame`</span> or <span class="in">`tibble`</span> with at least one geometry (<span class="in">`sfc`</span>) column</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Operations *not* involving geometry (<span class="in">`data.frame`</span>; base R; tidyverse)</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>geometry column + <span class="in">`sf`</span> class is sticky!</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>this can be convenient, and sometimes annoying</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>use <span class="in">`as.data.frame`</span> or <span class="in">`as_tibble`</span> to strip the <span class="in">`sf`</span> class label</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Operations involving *only* geometry</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**predicates** (resulting <span class="in">`TRUE`</span>/<span class="in">`FALSE`</span>)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>unary</span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>binary: <span class="co">[</span><span class="ot">DE9-IM</span><span class="co">](https://en.wikipedia.org/wiki/DE-9IM)</span>; work on two sets, result <span class="in">`sgbp`</span>, which is a sparse logical matrix representation</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a><span class="ss">            -   </span>is_within_distance</span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**measures**</span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>unary: length, area</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>binary: distance, <span class="in">`by_element = FALSE`</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>**transformers**</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>unary: buffer, centroid</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>binary: intersection, union, difference, symdifference</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a><span class="ss">        -   </span>n-ary: intersection, difference</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Operations involving geometry *and* attributes</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>many of the above!</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`st_join`</span></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`aggregate`</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span><span class="in">`st_interpolate_aw`</span>: requires expression whether variable is spatially *extensive* or *intensive*</span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `sf` and `spatstat`</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>We can try to convert an <span class="in">`sf`</span> object to a <span class="in">`ppp`</span> (point pattern object in <span class="in">`spatstat`</span>):</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r error=TRUE}</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a><span class="in">library(sf)</span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a><span class="in">library(spatstat)</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a><span class="in">demo(nc, echo = FALSE, ask = FALSE)</span></span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a><span class="in">pts = st_centroid(st_geometry(nc))</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a><span class="in">as.ppp(pts) # ???</span></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>Note that <span class="in">`sf`</span> interprets a <span class="in">`NA`</span> CRS as: flat, projected (Cartesian) space.</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a><span class="fu">#### `stars`</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>Packages <span class="in">`stars`</span> is a package for (dense) array data, where array</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>dimensions are associated with space and/or time (spatial time</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>series, data cubes). It is built for simplicity (pure R), and for</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>maximum integration with <span class="in">`sf`</span>.</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>R's <span class="in">`array`</span> is very powerful, but its metadata (<span class="in">`dimnames`</span>) is</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>restricted to <span class="in">`character`</span> vectors.</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>A <span class="in">`stars`</span> object </span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>is a list with R arrays (or pointers to files with such arrays)</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>has a <span class="in">`dimensions`</span> attribute with all the metadata of the dimensions</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>(offset, cellsize, units, reference system, point/block support)</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_stars</span>() <span class="co"># default: 1 degree global Cartesian grid</span></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a><span class="fu">### Valid polygons</span></span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>Valid polygons are polygons with several geometrical constraints, such as</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a closed ring means the first and last coordinate are identical,</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>no edge is traversed twice,</span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>a hole can touch an outer ring only in a point, not along a line(string)</span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>holes are inside the outer ring</span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>outer rings are winded counter-clockwise (CCW), inner rings (holes) clockwise (CW)</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>In particular the last condition is often dropped, as the order of the rings already denotes</span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>their role, and winding can easily reversed. An exception of this is polygons on the sphere,</span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>where _both_ inside and outside have a limited area.</span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a><span class="fu">### DE-9IM: dimensionally extended nine-intersection model</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>The _intersection_ of two geometries is the set of</span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>points they have in common. This set can be empty (no</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>points), 0-, 1-, or 2-dimensional. The DE-9IM defines the</span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>**relation** between two geometries as the intersection of I,</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>B and E of the first and the second geometry (hence: 9, see</span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>https://r-spatial.org/book/03-Geometries.html#fig-de9im).  The values</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>can be <span class="in">`F`</span> (empty), <span class="in">`0`</span>, <span class="in">`1`</span> or <span class="in">`2`</span> (dimension if not empty), or <span class="in">`T`</span></span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>(not empty: any of 0, 1 or 2). Using the resulting encoding (the</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>relation), one can define special predicates, such as </span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A _covers_ B</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A _contains_ B</span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A is _disjoint_ from B</span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A _equals_ B</span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>and many more on; one can also define custom queries with a specific pattern, e.g.:</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>A _relates_ to B according to pattern <span class="in">`0FFFFFFF2`</span>.</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a><span class="fu">### DE9-IM: challenges</span></span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>We often work with polygon data that form a _polygon coverage_,</span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>which is a tesselation of an area of interest, e.g.</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>countries in a continent, </span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>provinces in a country,</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>counties in a province</span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>When representing the polygons as a set of outer rings, it is hard</span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>to see whether there are no overlaps, and no gaps between polygons.</span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>Such overlaps or gaps could result from generalisation of polygon</span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>boundaries, one-by-one, and not by first identifying a common</span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>boundary and then generalizing that. </span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>"True" geographic information systems (e.g. ArcGIS or GRASS GIS)</span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>use a topological representation of geometries that consists of</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>edge nodes and (outer and inner) _boundaries_, and can do such</span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>simplifications without creating overlaps or gaps.</span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>Another challenge is that polygon coverages represented as a set of</span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>simple feature polygons do not uniquely assign all points to a single</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>unit. Points on a boundary common to two geometries intersect with</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>both, there is no geometric argument to assign them unambiguously</span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>to only one of them.</span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>Finally, as the Earth is round, the use of _straight lines_ is problematic:</span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>projection or re-projection changes space non-linearly, causing a straight line to change path</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>unprojected data are associated with a sphere (or ellipsoid), leading to **options** what "straight" means, e.g.</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>GeoJSON <span class="co">[</span><span class="ot">defines straight lines</span><span class="co">](https://datatracker.ietf.org/doc/html/rfc7946#section-3.1.1)</span> as straight in Plate Carree</span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a><span class="ss">    * </span>s2geometry assumes <span class="co">[</span><span class="ot">great circle</span><span class="co">](https://en.wikipedia.org/wiki/Great-circle_distance)</span> segments</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a><span class="fu">### vector and raster data</span></span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>In addition to vector (point/line/polygon) data, we also have</span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>_raster data_. For _regular_ rasters, space is cut into square</span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>cells, aligned with $x$ and $y$.  Raster spaces _can_ tesselate, see</span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">here</span><span class="co">](https://r-spatial.org/book/03-Geometries.html#raster-tessellations)</span>.</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>In addition to regular rasters, we have rotated, sheared, rectilinear</span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>and curvilinear rasters. The raster _space_ is primarily flat,</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>so any time we use it model data of the Earth surface, we violate</span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>the constant raster cell size concept. Many data are distributed</span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>as regular rasters in geodetic coordinates (long/lat space, e.g.,</span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>0.25 degree raster cells), mostly for convienience (of who?)</span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>**Discrete global grids** are (semi-)regular tesselations of the</span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>Earth surface, using squares, triangles, or hexagons. Examples are:</span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Google's <span class="co">[</span><span class="ot">s2geometry</span><span class="co">](http://s2geometry.io/)</span> (R package <span class="co">[</span><span class="ot">s2</span><span class="co">](https://cran.r-project.org/web/packages/s2/index.html)</span>)</span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Uber's <span class="co">[</span><span class="ot">H3</span><span class="co">](https://www.uber.com/en-FR/blog/h3/)</span> (R package <span class="co">[</span><span class="ot">h3r</span><span class="co">](https://cran.r-project.org/web/packages/h3r/index.html)</span>)</span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Kevin Sahr's <span class="co">[</span><span class="ot">dggrid</span><span class="co">](https://discreteglobal.wpengine.com/)</span> (also nested hexagons; R package <span class="co">[</span><span class="ot">dggridr</span><span class="co">](https://cran.r-project.org/web/packages/dggridR/index.html)</span>)</span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>Interestingly, computer screens are raster devices, so any time</span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>we do view vector data on a computer screen, a rasterization has</span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>taken place.</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a><span class="fu">### data cubes</span></span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>Data cubes are _array data_ with one or more dimensions associated</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>with space or geometry. The degenerate example is a one-dimensional</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>array (or collection thereof), which we have in a table or</span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>data.frame.  The canonical example of array data is raster data,</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>or a time series thereof. </span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>Further examples include:</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>3D rasters, including depth/height (atmospheric, geological)</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>time series for points (one dimension with feature geometries)</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>time series for areas (one dimension with feature geometries)</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Origin-destination (OD) matrices (two dimensions with feature geometries)</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>OD matrices as a function of time</span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a><span class="fu">## The spatial statistics data types</span></span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a><span class="fu">### Point Patterns</span></span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Points (locations) + observation window</span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Example from <span class="co">[</span><span class="ot">here</span><span class="co">](https://opendata-esri-de.opendata.arcgis.com/datasets/dc6d012f47d94fde99deacc316721f30/explore?location=51.099061%2C10.453852%2C7.45)</span></span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fig-gdal-fig-nodetails, echo = FALSE}</span></span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a><span class="in">#| code-fold: true</span></span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a><span class="in">#| out.width: '100%'</span></span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig.cap: "Wind turbine parks in Germany"</span></span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::include_graphics("turbines.png")</span></span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The locations contain the information</span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Points may have (discrete or continuous) *marks* (attributes)</span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The _observation window_ tells where there are no points (empty space)</span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a><span class="fu">### Geostatistical data: locations + measured values</span></span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: '100%'</span></span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "NO2 measurements at rural background stations (EEA)"</span></span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a>no2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">system.file</span>(<span class="st">"external/no2.csv"</span>,</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">package =</span> <span class="st">"gstat"</span>))</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a>crs <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(<span class="st">"EPSG:32632"</span>)</span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a><span class="fu">st_as_sf</span>(no2, <span class="at">crs =</span> <span class="st">"OGC:CRS84"</span>, <span class="at">coords =</span></span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"station_longitude_deg"</span>, <span class="st">"station_latitude_deg"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_transform</span>(crs) <span class="ot">-&gt;</span> no2.sf</span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(st_geometry(no2.sf))</span></span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a><span class="fu">read_sf</span>(<span class="st">"de_nuts1.gpkg"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(crs) <span class="ot">-&gt;</span> de</span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> de) <span class="sc">+</span></span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> no2.sf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">col =</span> NO2))</span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The value of interest is measured at a set of sample locations</span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>At other location, this value exists but is *missing*</span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The interest is in estimating (predicting) this missing value (interpolation)</span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The actual sample locations are not of (primary) interest, the signal is in the measured values</span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a><span class="fu">### Areal data</span></span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>polygons (or grid cells) + polygon summary values</span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: '100%'</span></span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "NO2 rural background, average values per NUTS1 region"</span></span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a><span class="co"># https://en.wikipedia.org/wiki/List_of_NUTS_regions_in_the_European_Union_by_GDP</span></span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>de<span class="sc">$</span>GDP_percap <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">45200</span>, <span class="dv">46100</span>, <span class="dv">37900</span>, <span class="dv">27800</span>, <span class="dv">49700</span>, <span class="dv">64700</span>, <span class="dv">45000</span>, <span class="dv">26700</span>, <span class="dv">36500</span>, <span class="dv">38700</span>, <span class="dv">35700</span>, <span class="dv">35300</span>, <span class="dv">29900</span>, <span class="dv">27400</span>, <span class="dv">32400</span>, <span class="dv">28900</span>)</span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="at">data =</span> de) <span class="sc">+</span></span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> de, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> GDP_percap)) <span class="sc">+</span> </span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> <span class="fu">st_cast</span>(de, <span class="st">"MULTILINESTRING"</span>), <span class="at">col =</span> <span class="st">'white'</span>)</span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>The polygons contain polygon summary (polygon support) values, not values that are constant throughout the polygon (as in a soil, lithology or land cover map)</span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Neighbouring polygons are typically related: spatial correlation</span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>neighbour-neighbour correlation: Moran's I</span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>regression models with correlated errors, spatial lag models, CAR models, GMRFs, ...</span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>see Ch 14-17 of <span class="co">[</span><span class="ot">SDSWR</span><span class="co">](https://r-spatial.org/book/)</span></span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>briefly addressed on Friday</span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data types that received less attention in the spatial statistics literature</span></span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a><span class="fu">### Image data</span></span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: '100%'</span></span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "RGB image from a Landsat scene"</span></span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stars)</span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(L7_ETMs, <span class="at">rgb =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>are these geostatistical data, or areal data?</span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If we identify objects from images, can we see them as point patterns?</span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a><span class="fu">### Tracking data, trajectories</span></span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-389"><a href="#cb8-389" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb8-390"><a href="#cb8-390" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: true</span></span>
<span id="cb8-391"><a href="#cb8-391" aria-hidden="true" tabindex="-1"></a><span class="co">#| out.width: '100%'</span></span>
<span id="cb8-392"><a href="#cb8-392" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.cap: "Storm/hurricane trajectories colored by year"</span></span>
<span id="cb8-393"><a href="#cb8-393" aria-hidden="true" tabindex="-1"></a><span class="co"># from: https://r-spatial.org/r/2017/08/28/nest.html</span></span>
<span id="cb8-394"><a href="#cb8-394" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb8-395"><a href="#cb8-395" aria-hidden="true" tabindex="-1"></a>storms.sf <span class="ot">&lt;-</span> storms <span class="sc">%&gt;%</span></span>
<span id="cb8-396"><a href="#cb8-396" aria-hidden="true" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb8-397"><a href="#cb8-397" aria-hidden="true" tabindex="-1"></a>storms.sf <span class="ot">&lt;-</span> storms.sf <span class="sc">%&gt;%</span> </span>
<span id="cb8-398"><a href="#cb8-398" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">as.POSIXct</span>(<span class="fu">paste</span>(<span class="fu">paste</span>(year,month,day, <span class="at">sep =</span> <span class="st">"-"</span>), </span>
<span id="cb8-399"><a href="#cb8-399" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">paste</span>(hour, <span class="st">":00"</span>, <span class="at">sep =</span> <span class="st">""</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb8-400"><a href="#cb8-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="sc">-</span>month, <span class="sc">-</span>day, <span class="sc">-</span>hour)</span>
<span id="cb8-401"><a href="#cb8-401" aria-hidden="true" tabindex="-1"></a>storms.nest <span class="ot">&lt;-</span> storms.sf <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(name, year) <span class="sc">%&gt;%</span> nest</span>
<span id="cb8-402"><a href="#cb8-402" aria-hidden="true" tabindex="-1"></a>to_line <span class="ot">&lt;-</span> <span class="cf">function</span>(tr) <span class="fu">st_cast</span>(<span class="fu">st_combine</span>(tr), <span class="st">"LINESTRING"</span>) <span class="sc">%&gt;%</span> .[[<span class="dv">1</span>]] </span>
<span id="cb8-403"><a href="#cb8-403" aria-hidden="true" tabindex="-1"></a>tracks <span class="ot">&lt;-</span> storms.nest <span class="sc">%&gt;%</span> <span class="fu">pull</span>(data) <span class="sc">%&gt;%</span> <span class="fu">map</span>(to_line) <span class="sc">%&gt;%</span> <span class="fu">st_sfc</span>(<span class="at">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb8-404"><a href="#cb8-404" aria-hidden="true" tabindex="-1"></a>storms.tr <span class="ot">&lt;-</span> storms.nest <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span> <span class="fu">st_sf</span>(<span class="at">geometry =</span> tracks)</span>
<span id="cb8-405"><a href="#cb8-405" aria-hidden="true" tabindex="-1"></a>storms.tr <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> year)) <span class="sc">+</span> <span class="fu">geom_sf</span>()</span>
<span id="cb8-406"><a href="#cb8-406" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb8-407"><a href="#cb8-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-408"><a href="#cb8-408" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>A temporal snapshot (time slice) of a set of moving things forms a point pattern</span>
<span id="cb8-409"><a href="#cb8-409" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>We often analyse trajectories by</span>
<span id="cb8-410"><a href="#cb8-410" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>estimating densities, for space-time blocks, per individual or together</span>
<span id="cb8-411"><a href="#cb8-411" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>analysing interactions (alibi problem, mating animals, home range, UDF etc)</span>
<span id="cb8-412"><a href="#cb8-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-413"><a href="#cb8-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-414"><a href="#cb8-414" aria-hidden="true" tabindex="-1"></a><span class="fu">### Design-based statistics</span></span>
<span id="cb8-415"><a href="#cb8-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-416"><a href="#cb8-416" aria-hidden="true" tabindex="-1"></a>In design-based statistics, randomness comes from random sampling. Consider an area $B$, from which we take samples $$z(s),</span>
<span id="cb8-417"><a href="#cb8-417" aria-hidden="true" tabindex="-1"></a>s \in B,$$ with $s$ a location for instance two-dimensional: $s_i =</span>
<span id="cb8-418"><a href="#cb8-418" aria-hidden="true" tabindex="-1"></a><span class="sc">\{</span>x_i,y_i<span class="sc">\}</span>$. If we select the samples *randomly*, we can consider $S \in B$ a random variable, and $z(S)$ a random sample. Note the randomness in $S$, not in $z$.</span>
<span id="cb8-419"><a href="#cb8-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-420"><a href="#cb8-420" aria-hidden="true" tabindex="-1"></a>Two variables $z(S_1)$ and $z(S_2)$ are *independent* if $S_1$ and $S_2$ are sampled independently. For estimation we need to know the inclusion probabilities, which need to be non-negative for every location.</span>
<span id="cb8-421"><a href="#cb8-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-422"><a href="#cb8-422" aria-hidden="true" tabindex="-1"></a>If inclusion probabilities are constant (simple random sampling; or complete spatial randomness: day 2, point patterns) then we can estimate the mean of $Z(B)$ by the sample mean $$\frac{1}{n}\sum_{j=1}^n</span>
<span id="cb8-423"><a href="#cb8-423" aria-hidden="true" tabindex="-1"></a>z(s_j).$$ This also predicts the value of a *randomly* chosen observation $z(S)$. It cannot be used to predict the value $z(s_0)$ for a non-randomly chosen location $s_0$; for this we need a model.</span>
<span id="cb8-424"><a href="#cb8-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-425"><a href="#cb8-425" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model-based statistics</span></span>
<span id="cb8-426"><a href="#cb8-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-427"><a href="#cb8-427" aria-hidden="true" tabindex="-1"></a>Model-based statistics assumes randomness in the measured responses; consider a regression model $y = X\beta + e$, where $e$ is a random variable and as a consequence $y$, the response variable is a random variable. In the spatial context we replace $y$ with $z$, and capitalize it to indicate it is a random variable, and write $$Z(s) = X(s)\beta + e(s)$$ to stress that</span>
<span id="cb8-428"><a href="#cb8-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-429"><a href="#cb8-429" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$Z(s)$ is a random function (random variables $Z$ as a function of $s$)</span>
<span id="cb8-430"><a href="#cb8-430" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$X(s)$ is the matrix with covariates, which depend on $s$</span>
<span id="cb8-431"><a href="#cb8-431" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$\beta$ are (spatially) constant coefficients, not depening on $s$</span>
<span id="cb8-432"><a href="#cb8-432" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>$e(s)$ is a random function with mean zero and covariance matrix $\Sigma$</span>
<span id="cb8-433"><a href="#cb8-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-434"><a href="#cb8-434" aria-hidden="true" tabindex="-1"></a>In the regression literature this is called a (linear) mixed model, because $e$ is not i.i.d. If $e(s)$ contains an iid component $\epsilon$ we can write this as</span>
<span id="cb8-435"><a href="#cb8-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-436"><a href="#cb8-436" aria-hidden="true" tabindex="-1"></a>$$Z(s) = X(s)\beta + w(s) + \epsilon$$</span>
<span id="cb8-437"><a href="#cb8-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-438"><a href="#cb8-438" aria-hidden="true" tabindex="-1"></a>with $w(s)$ the spatial signal, and $\epsilon$ a noise compenent e.g. due to measurement error.</span>
<span id="cb8-439"><a href="#cb8-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-440"><a href="#cb8-440" aria-hidden="true" tabindex="-1"></a>Predicting $Z(s_0)$ will involve (GLS) estimation of $\beta$, but also prediction of $e(s_0)$ using correlated, nearby observations (day 3: geostatistics).</span>
<span id="cb8-441"><a href="#cb8-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-442"><a href="#cb8-442" aria-hidden="true" tabindex="-1"></a><span class="fu">### Design- or model-based?</span></span>
<span id="cb8-443"><a href="#cb8-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-444"><a href="#cb8-444" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>design-based requires a random sample, if that is the case it needs no further assumptions</span>
<span id="cb8-445"><a href="#cb8-445" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>model-based requires stationarity assumptions to estimate $\Sigma$</span>
<span id="cb8-446"><a href="#cb8-446" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>model-based is typically more effective for interpolation problems</span>
<span id="cb8-447"><a href="#cb8-447" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>design-based can be most effective when estimating, e.g. average mapping errors</span>
<span id="cb8-448"><a href="#cb8-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-449"><a href="#cb8-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-450"><a href="#cb8-450" aria-hidden="true" tabindex="-1"></a><span class="fu">## Checklist if you have spatial data</span></span>
<span id="cb8-451"><a href="#cb8-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-452"><a href="#cb8-452" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Do you have the spatial coordinates of your data?</span>
<span id="cb8-453"><a href="#cb8-453" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Are the coordinates Earth-bound?</span>
<span id="cb8-454"><a href="#cb8-454" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>If yes, do you have the coordinate reference system of them?</span>
<span id="cb8-455"><a href="#cb8-455" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the support (physical size) of your observations?</span>
<span id="cb8-456"><a href="#cb8-456" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Were the data obtained by random sampling, and if yes, do you have sampling weights?</span>
<span id="cb8-457"><a href="#cb8-457" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Do you know the *extent* from which your data were sampled, or collected?</span>
<span id="cb8-458"><a href="#cb8-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-459"><a href="#cb8-459" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb8-460"><a href="#cb8-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-461"><a href="#cb8-461" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>What is the coordinate reference system of the <span class="in">`ne_countries()`</span> dataset, imported above?</span>
<span id="cb8-462"><a href="#cb8-462" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Look up the "Equidistant Cylindrical (Plate Carrée)" projection on the <span class="ot">&lt;https://proj.org&gt;</span> website.</span>
<span id="cb8-463"><a href="#cb8-463" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Why is this projection called *The simplest of all projections*?</span>
<span id="cb8-464"><a href="#cb8-464" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Project <span class="in">`ne_countries`</span> to Plate Carrée, and plot it with <span class="in">`axes=TRUE`</span>. What has changed? (Hint: <span class="in">`st_crs()`</span> accepts a *proj string* to define a coordinate reference system (CRS); <span class="in">`st_transform()`</span> transforms a dataset to a new CRS.)</span>
<span id="cb8-465"><a href="#cb8-465" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Project the same dataset to Eckert IV projection. What has changed?</span>
<span id="cb8-466"><a href="#cb8-466" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Also try plotting this dataset after transforming it to an orthographic projection with <span class="in">`+proj=ortho`</span>; what went wrong?</span>
<span id="cb8-467"><a href="#cb8-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-468"><a href="#cb8-468" aria-hidden="true" tabindex="-1"></a>Next: continue with the [exercises of Chapter</span>
<span id="cb8-469"><a href="#cb8-469" aria-hidden="true" tabindex="-1"></a>3](https://r-spatial.org/book/03-Geometries.html#exercises) of</span>
<span id="cb8-470"><a href="#cb8-470" aria-hidden="true" tabindex="-1"></a>"Spatial Data Science: with applications in R", then [those of</span>
<span id="cb8-471"><a href="#cb8-471" aria-hidden="true" tabindex="-1"></a>Chapter 6](https://r-spatial.org/book/06-Cubes.html#exercises).</span>
<span id="cb8-472"><a href="#cb8-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-473"><a href="#cb8-473" aria-hidden="true" tabindex="-1"></a><span class="fu">## Further reading</span></span>
<span id="cb8-474"><a href="#cb8-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-475"><a href="#cb8-475" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Ripley, B. 1981. Spatial Statistics. Wiley.</span>
<span id="cb8-476"><a href="#cb8-476" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cressie, N. 1993. Statistics for Spatial Data. Wiley.</span>
<span id="cb8-477"><a href="#cb8-477" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Cochran, W.G. 1977. Sampling Techniques. Wiley.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/edzer/madrid/edit/main/day1.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>